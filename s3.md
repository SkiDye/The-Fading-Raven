# 세션 3: 적 & AI

## 담당 범위
- 15종 적 구현
- 적 AI 행동 패턴
- 웨이브 생성 시스템
- 보스 메카닉

## 구현 항목
1. **적 엔티티 시스템** (`js/entities/enemy.js`)
   - 기본 적 클래스
   - 타입별 특수 행동

2. **AI 행동 트리** (`js/ai/behavior-tree.js`)
   - 이동, 공격, 특수 행동
   - 우선순위 타겟팅

3. **적 유형 구현**
   - Tier 1: Rusher, Gunner, Shield Trooper
   - Tier 2: Jumper, Heavy Trooper, Hacker, Storm Creature
   - Tier 3: Brute, Sniper, Drone Carrier, Shield Generator
   - Boss: Pirate Captain, Storm Core

4. **웨이브 생성기** (`js/core/wave-generator.js`)
   - 예산 기반 생성
   - 난이도 스케일링
   - 구성 다양화

5. **특수 메카닉**
   - Hacker 터렛 해킹
   - Drone Carrier 드론 스폰
   - Shield Generator 아군 보호
   - Sniper 조준 시스템

## 산출물
- `js/entities/enemy.js`
- `js/ai/*.js`
- `docs/implementation/enemy-ai.md`

---

## 통합 테스트 피드백 (2026-02-03)

### 테스트 결과
```
Session 3: Enemy/AI System - 13/13 ✓ (100%)
```

### 검증된 항목
- [x] EnemyFactory 로드 및 API (create, createBatch)
- [x] AIManager 로드 및 클래스 메서드 (updateEnemy, updateAll, clear)
- [x] WaveGenerator 클래스 (generateWaves)
- [x] WaveManager 클래스 (initialize, startNextWave, update, getProgress)
- [x] EnemyMechanicsManager 클래스 (update, startHacking, getSniperLasers, isEnemyShielded)

### 발견된 이슈

#### L-001: AIManager 클래스 문서화 필요
**우선순위:** Low

**설명:**
`AIManager`가 클래스로 구현되어 있어 사용 시 인스턴스 생성이 필요함.
SHARED-STATE.md의 인터페이스 문서와 실제 구현이 다름.

**현재 구현:**
```javascript
class AIManager {
    constructor() { ... }
    updateEnemy(enemy, context) { ... }
    updateAll(enemies, context) { ... }
    clear() { ... }
}
window.AIManager = AIManager;
```

**사용 방법:**
```javascript
const aiManager = new AIManager();
aiManager.updateAll(enemies, context);
```

**권장 조치:**
1. SHARED-STATE.md 인터페이스 문서 업데이트
2. 또는 싱글톤 패턴으로 변경 고려

### 밸런스 분석 결과

**적 카운터 매트릭스 확인:**
- 각 적 유형별 카운터 클래스 적절히 설정됨
- Brute → Sentinel 카운터 ◎
- Sniper → Bionic 카운터 ◎
- 전체적으로 균형 잡힌 설계

**난이도 스케일링:**
- Normal → Nightmare: 적 예산 +148% 증가
- 적절한 난이도 곡선

### 권장 개선사항
1. 보스 메카닉 상세 테스트 필요
2. Storm Creature 특수 행동 검증
3. Drone Carrier 드론 스폰 타이밍 조정 검토

---

## UX 플로우 검증 피드백 (2026-02-03)

### 적/AI 관련 이슈

#### M-008: 적 특수 행동 사전 경고 부족
**우선순위:** Medium

**설명:**
Sniper 조준, Hacker 해킹 시작 등 특수 행동 시
플레이어에게 충분한 경고가 제공되지 않아 대응 기회 부족.

**영향 받는 적:**
- Sniper: 조준 시작 시 레이저만 표시, 사운드/아이콘 없음
- Hacker: 해킹 시작 시 시각적 피드백 미약
- Jumper: 점프 준비 동작 표시 없음

**권장 조치:**
```javascript
// 특수 행동 경고 시스템
const SpecialActionWarning = {
    show(enemy, actionType, duration) {
        // 적 위에 경고 아이콘 표시
        // 위험 범위 표시
        // 경고음 재생 (선택)
    }
};
```

---

#### M-009: Shield Generator 보호 범위 표시
**우선순위:** Medium

**설명:**
Shield Generator가 아군을 보호하는 범위가
게임 중 명확히 표시되지 않음. 플레이어가 어떤 적이 보호되는지 파악하기 어려움.

**권장 조치:**
- Shield Generator 주변에 반투명 보호 필드 표시
- 보호받는 적에게 쉴드 아이콘 표시
- 툴팁에 보호 범위 정보 추가

---

#### L-008: Drone Carrier 드론 스폰 위치 표시
**우선순위:** Low

**설명:**
Drone Carrier가 드론을 스폰할 때 스폰 위치 예고 없이
갑자기 드론이 등장함.

**권장 조치:**
- 드론 스폰 1초 전 스폰 위치에 경고 표시
- 스폰 애니메이션 추가

---

#### L-009: 보스 페이즈 전환 표시
**우선순위:** Low

**설명:**
보스가 페이즈 전환 시 체력 임계점에서 패턴 변경되나
플레이어에게 명확한 피드백 없음.

**권장 조치:**
- 보스 체력바에 페이즈 구분선 표시
- 페이즈 전환 시 화면 연출 추가
- "보스 광폭화!" 등 텍스트 표시

---

### 웨이브 시스템 관련 이슈

#### M-010: 웨이브 구성 미리보기 부재
**우선순위:** Medium

**설명:**
다음 웨이브에 어떤 적이 등장하는지 정보가 없어
플레이어가 전략적 준비 불가.

**권장 조치:**
```javascript
// 웨이브 시작 전 미리보기
function showWavePreview(waveData) {
    // 등장 적 유형 아이콘 표시
    // 특수 적 경고 표시
    // "준비 완료" 버튼으로 시작
}
```

---

#### L-010: 적 처치 시 처치 정보 표시
**우선순위:** Low

**설명:**
적 처치 시 어떤 크루가 처치했는지, 데미지 등
상세 정보 표시 없음.

**권장 조치:**
- 킬로그 표시 (선택적)
- 처치 크루에 +1 표시
- 경험치/점수 획득 플로팅 텍스트

---

### AI 행동 검증 체크리스트

| 적 유형 | 기본 공격 | 특수 행동 | 시각 피드백 | 비고 |
|---------|----------|----------|------------|------|
| Rusher | ✓ | - | ✓ | |
| Gunner | ✓ | - | ✓ | |
| Shield Trooper | ✓ | 쉴드 | ⚠️ | 쉴드 상태 표시 개선 필요 |
| Jumper | ✓ | 점프 | ⚠️ | 준비 동작 필요 |
| Heavy Trooper | ✓ | - | ✓ | |
| Hacker | ✓ | 해킹 | ⚠️ | 해킹 대상 강조 필요 |
| Storm Creature | ✓ | 방전 | ⚠️ | 범위 표시 필요 |
| Brute | ✓ | 돌진 | ✓ | |
| Sniper | ✓ | 조준 | ✓ | 레이저 표시됨 |
| Drone Carrier | ✓ | 스폰 | ⚠️ | 스폰 예고 필요 |
| Shield Generator | ✓ | 보호 | ⚠️ | 범위 표시 필요 |

---

### 추가 검증 필요 항목
1. [ ] 다수 적 동시 특수 행동 시 우선순위
2. [ ] AI 경로 탐색 엣지 케이스 (막힌 경로)
3. [ ] 보스 특수 패턴 전체 테스트
4. [ ] 난이도별 AI 공격성 차이 체감

---

## UX 피드백 수정 완료 (2026-02-03)

### 수정된 이슈

| 이슈 | 우선순위 | 수정 내용 |
|------|----------|-----------|
| L-001 | Low | SHARED-STATE.md AIManager 문서를 클래스 기반으로 업데이트 |
| M-008 | Medium | `specialActionWarning` 이벤트 추가 (Sniper, Hacker, Jumper, StormCreature) |
| M-009 | Medium | `getShieldVisuals()` 강화 - 위치, 반경, 보호 대상 ID 포함 |
| M-010 | Medium | `getNextWavePreview()` 메서드 추가 - 적 구성, 경고 메시지 포함 |
| L-008 | Low | `droneSpawnWarning` 이벤트 추가 - 스폰 위치 예고 |
| L-009 | Low | `bossPhaseWarning` 이벤트 추가 - 페이즈 전환 경고 |
| L-010 | Low | `death` 이벤트 강화 - 데미지 기여도, 처치자 정보 포함 |

### 추가된 이벤트

```javascript
// 특수 행동 경고 (enemy.js)
enemy.on('specialActionWarning', {
    enemy, actionType, warningDuration, targetPosition, dangerRadius
});

// 드론 스폰 경고 (enemy-mechanics.js)
mechanicsManager.on('droneSpawnWarning', {
    carrier, spawnPositions, count, warningDuration
});

// 보스 페이즈 경고 (enemy.js)
enemy.on('bossPhaseWarning', {
    enemy, phaseName, isEnraged, message
});

// 웨이브 미리보기 (wave-generator.js)
waveManager.getNextWavePreview(); // Returns enemySummary, specialEnemies, warnings
```

### 업데이트된 렌더 데이터

```javascript
// Enemy.getRenderData() 추가 필드
{
    hasShield: boolean,      // 쉴드 보호 여부
    shieldType: string,      // 쉴드 타입
    currentPhase: number,    // 보스 현재 페이즈
    totalPhases: number,     // 보스 총 페이즈
}

// ShieldGeneratorEnemy.getRenderData() 추가 필드
{
    shieldRadius: number,
    shieldedCount: number,
    shieldedEnemyIds: array,
    isShieldGenerator: true,
    shieldEffect: string,
}
```
