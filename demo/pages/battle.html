<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle - The Fading Raven</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/ui-components.css">
    <link rel="stylesheet" href="../css/effects.css">
    <link rel="stylesheet" href="../css/pages/battle.css">
</head>
<body>
    <div class="page-container battle-page">
        <!-- Top HUD -->
        <header class="battle-hud top">
            <div class="hud-left">
                <div class="hud-stat">
                    <span class="stat-label">웨이브</span>
                    <span class="stat-value" id="hud-wave">1/3</span>
                </div>
                <div class="hud-stat">
                    <span class="stat-label">남은 적</span>
                    <span class="stat-value" id="hud-enemies">0</span>
                </div>
            </div>
            <div class="hud-center">
                <div class="station-health">
                    <span class="stat-label">스테이션</span>
                    <div class="health-bar-container">
                        <div class="health-bar-fill" id="station-health-bar"></div>
                    </div>
                    <span class="stat-value" id="hud-station">100%</span>
                </div>
            </div>
            <div class="hud-right">
                <button class="btn btn-hud" id="btn-pause" title="일시정지 (Space)">⏸ 일시정지</button>
            </div>
        </header>

        <!-- Battle Canvas -->
        <main class="battle-main">
            <canvas id="battle-canvas"></canvas>

            <!-- Wave Announcement -->
            <div class="wave-announcement" id="wave-announcement">
                <span class="wave-text" id="wave-text">웨이브 1</span>
            </div>

            <!-- Damage Numbers Container -->
            <div class="damage-numbers" id="damage-numbers"></div>
        </main>

        <!-- Bottom HUD -->
        <footer class="battle-hud bottom">
            <!-- Selected Unit Panel -->
            <div class="selected-unit-panel" id="selected-panel">
                <button class="deselect-btn" id="btn-deselect" title="선택 해제 (ESC)">✕</button>
                <div class="unit-portrait" id="unit-portrait">
                    <div class="portrait-icon">G</div>
                    <div class="health-ring" id="health-ring"></div>
                </div>
                <div class="unit-info">
                    <h4 class="unit-name" id="unit-name">Guardian Squad</h4>
                    <div class="unit-health">
                        <div class="health-bar">
                            <div class="health-fill" id="unit-health"></div>
                        </div>
                        <span class="health-text" id="health-text">8/8</span>
                    </div>
                    <span class="unit-status" id="unit-status">Ready</span>
                </div>
                <div class="unit-actions">
                    <button class="skill-btn" id="btn-skill" disabled>
                        <span class="skill-icon" id="skill-icon">🛡️</span>
                        <span class="skill-name" id="skill-name">Shield Bash</span>
                        <span class="skill-cooldown" id="skill-cooldown"></span>
                    </button>
                </div>
                <span class="deselect-hint">ESC로 선택 해제</span>
            </div>

            <!-- Crew Quick Select -->
            <div class="crew-quick-select" id="crew-buttons">
                <!-- Quick select buttons generated here -->
            </div>

            <!-- Raven Drone Panel -->
            <div class="raven-panel" id="raven-panel">
                <h4>RAVEN</h4>
                <div class="raven-abilities">
                    <button class="raven-btn" id="btn-scout" title="Scout next wave">
                        <span class="icon">🔭</span>
                        <span class="uses">∞</span>
                    </button>
                    <button class="raven-btn" id="btn-flare" title="Flare">
                        <span class="icon">🔦</span>
                        <span class="uses" id="flare-uses">2</span>
                    </button>
                    <button class="raven-btn" id="btn-resupply" title="Emergency Resupply">
                        <span class="icon">📦</span>
                        <span class="uses" id="resupply-uses">1</span>
                    </button>
                    <button class="raven-btn" id="btn-strike" title="Orbital Strike">
                        <span class="icon">💥</span>
                        <span class="uses" id="strike-uses">1</span>
                    </button>
                </div>
            </div>
        </footer>

        <!-- Pause Menu -->
        <div class="modal" id="pause-menu">
            <div class="modal-content">
                <h2>일시정지</h2>
                <div class="modal-buttons">
                    <button class="btn btn-primary" id="btn-resume">계속하기</button>
                    <button class="btn btn-secondary" id="btn-help">단축키 도움말</button>
                    <button class="btn btn-danger" id="btn-retreat-battle">후퇴</button>
                </div>
            </div>
        </div>

        <!-- Keyboard Help Modal (L-002) -->
        <div class="modal" id="keyboard-help-modal">
            <div class="modal-content keyboard-help">
                <h2>⌨️ 키보드 단축키</h2>
                <div class="shortcut-list">
                    <div class="shortcut-group">
                        <h3>기본 조작</h3>
                        <div class="shortcut-item">
                            <kbd>Space</kbd>
                            <span>일시정지 / 재개</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>ESC</kbd>
                            <span>선택 해제 / 취소</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>?</kbd>
                            <span>이 도움말 표시</span>
                        </div>
                    </div>
                    <div class="shortcut-group">
                        <h3>크루 선택</h3>
                        <div class="shortcut-item">
                            <kbd>1</kbd> ~ <kbd>9</kbd>
                            <span>크루 선택 (순서대로)</span>
                        </div>
                    </div>
                    <div class="shortcut-group">
                        <h3>크루 행동</h3>
                        <div class="shortcut-item">
                            <kbd>Q</kbd>
                            <span>스킬 사용</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>E</kbd>
                            <span>장비 사용</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>좌클릭</kbd>
                            <span>이동 명령</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>우클릭</kbd>
                            <span>공격 대상 지정</span>
                        </div>
                    </div>
                    <div class="shortcut-group">
                        <h3>카메라 조작</h3>
                        <div class="shortcut-item">
                            <kbd>스크롤</kbd>
                            <span>확대 / 축소</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Z</kbd> / <kbd>C</kbd>
                            <span>카메라 회전 (반시계/시계)</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>+</kbd> / <kbd>-</kbd>
                            <span>확대 / 축소</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>R</kbd>
                            <span>카메라 초기화</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>중클릭+드래그</kbd>
                            <span>카메라 이동</span>
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" id="btn-close-help">확인</button>
            </div>
        </div>

        <!-- Wave Complete Overlay -->
        <div class="overlay" id="wave-complete-overlay">
            <div class="overlay-content">
                <h2>WAVE COMPLETE</h2>
                <p id="wave-complete-text">Prepare for the next wave!</p>
                <button class="btn-primary" id="btn-next-wave">NEXT WAVE</button>
            </div>
        </div>

        <!-- Targeting Overlay (for skills) -->
        <div class="targeting-indicator" id="targeting-indicator">
            <span>Select Target</span>
        </div>
    </div>

    <script src="../js/core/utils.js"></script>
    <script src="../js/core/rng.js"></script>
    <!-- Data Modules -->
    <script src="../js/data/crews.js"></script>
    <script src="../js/data/equipment.js"></script>
    <script src="../js/data/traits.js"></script>
    <script src="../js/data/enemies.js"></script>
    <script src="../js/data/facilities.js"></script>
    <script src="../js/data/balance.js"></script>
    <!-- Core -->
    <script src="../js/core/game-state.js"></script>
    <script src="../js/core/tile-grid.js"></script>
    <script src="../js/core/skills.js"></script>
    <script src="../js/core/equipment-effects.js"></script>
    <script src="../js/core/raven.js"></script>
    <script src="../js/core/combat-mechanics.js"></script>
    <!-- Entities -->
    <script src="../js/entities/turret.js"></script>
    <script src="../js/entities/enemy.js"></script>
    <!-- AI System (Session 3) -->
    <script src="../js/ai/behavior-tree.js"></script>
    <script src="../js/ai/enemy-mechanics.js"></script>
    <script src="../js/ai/crew-ai.js"></script>
    <!-- Wave System (Session 3) -->
    <script src="../js/core/wave-generator.js"></script>
    <!-- Station (Session 4) -->
    <script src="../js/core/station-generator.js"></script>
    <!-- Isometric Rendering System -->
    <script src="../js/rendering/isometric-renderer.js"></script>
    <script src="../js/rendering/height-system.js"></script>
    <script src="../js/rendering/tile-renderer.js"></script>
    <script src="../js/rendering/depth-sorter.js"></script>
    <!-- UI Systems -->
    <script src="../js/ui/ui-components.js"></script>
    <script src="../js/ui/effects.js"></script>
    <script src="../js/ui/hud.js"></script>
    <!-- Battle -->
    <script src="../js/pages/battle.js"></script>
    <script src="../js/ui/battle-effects-integration.js"></script>
</body>
</html>
