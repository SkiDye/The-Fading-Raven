# 세션 1: Data & Core Systems

## 담당 범위
- 모든 게임 데이터 정의 (JSON/JS 객체)
- GameState 확장
- 데이터 검증 시스템

## 구현 항목
1. **크루 클래스 데이터** (`js/data/crews.js`)
   - Guardian, Sentinel, Ranger, Engineer, Bionic
   - 각 클래스별 스탯, 스킬 3단계, 색상

2. **장비 데이터** (`js/data/equipment.js`)
   - 10종 장비 정의
   - 업그레이드 단계별 효과/비용

3. **특성 데이터** (`js/data/traits.js`)
   - 15종 특성
   - 효과 수치, 적용 대상

4. **적 데이터** (`js/data/enemies.js`)
   - 15종 적 유닛
   - 티어별 스탯, 행동 패턴 ID

5. **시설 데이터** (`js/data/facilities.js`)
   - 5종 시설 모듈
   - 효과, 크레딧 수입

6. **밸런싱 상수** (`js/data/balance.js`)
   - 모든 수치 상수
   - 난이도별 배율

## 산출물
- `demo/js/data/*.js` (6개 파일)
- `docs/implementation/data-definitions.md`

---

## 통합 테스트 피드백 (2026-02-03)

### 테스트 결과
```
Session 1: Data Modules - 66/66 ✓ (100%)
Session 1: GameState - 16/16 ✓ (100%)
```

### 검증된 항목

**CrewData:**
- [x] 5개 클래스 존재
- [x] 각 클래스 baseSquadSize > 0
- [x] 각 클래스 스킬 3레벨 존재
- [x] 스킬 비용 정확 (Lv1: 7)

**EquipmentData:**
- [x] 10개 장비 존재
- [x] 패시브/액티브 쿨다운/액티브 횟수 타입별 존재

**TraitData:**
- [x] 15개 특성 존재 (전투 6, 유틸 5, 경제 4)
- [x] energetic 쿨다운 감소 효과
- [x] popular 분대크기 +1 효과

**EnemyData:**
- [x] 13+ 적 유형 존재
- [x] Tier 1/2/3 및 보스 존재
- [x] 깊이별 적 해금 작동

**FacilityData:**
- [x] 7+ 시설 존재
- [x] 거주모듈 크레딧 (1/2/3)
- [x] 특수 시설 효과 작동

**BalanceData:**
- [x] 4개 난이도 정의
- [x] 난이도별 배율 정확
- [x] 웨이브 설정 작동

**GameState:**
- [x] 런 생성/저장/로드
- [x] 크레딧 추가/사용
- [x] 크루 생성/관리

---

### 발견된 이슈

#### H-001: 경제 밸런스 적자 ✅ RESOLVED
**우선순위:** High → **해결됨**
**해결일:** 2026-02-03

**원인:**
경제 시뮬레이션 결과, Normal 난이도 10스테이지 플레이 시 심각한 적자 발생.

**수정 전:**
```
총 수입:  46 크레딧
총 지출: 117 크레딧
최종 잔액: -71 크레딧
```

**적용된 수정:**

1. **balance.js**
   - `healCost`: 20 → 12
   - `perfectDefenseBonus`: 2 → 5

2. **facilities.js**
   - `residentialSmall.credits`: 1 → 2
   - `residentialMedium.credits`: 2 → 3
   - `residentialLarge.credits`: 3 → 5

**수정 후:**
```
총 수입: 85 크레딧
총 지출: 77 크레딧
최종 잔액: +8 크레딧
✓ 타이트한 경제 (의도된 설계)
```

**개선 효과:**
- 수입: +39 (85% 증가)
- 지출: -40 (34% 감소)
- 잔액: +79 (적자 → 흑자)

---

### 추가 검증 필요 항목
1. [ ] Hard/VeryHard/Nightmare 경제 시뮬레이션
2. [ ] 장기 플레이 (15+ 스테이지) 경제 추이
3. [ ] 숙련(skillful) 특성 효과 반영 시 경제

---

## UX 플로우 검증 피드백 (2026-02-03)

### 데이터 모듈 관련 이슈
Session 1 담당 범위에서 직접적인 UX 이슈 없음.

### 데이터 검증 권장사항

#### L-006: 데이터 모듈 로드 검증 ✅ RESOLVED
**우선순위:** Low → **해결됨**
**해결일:** 2026-02-03

**설명:**
각 페이지에서 필수 데이터 모듈(CrewData, EquipmentData 등) 로드 실패 시
사용자에게 피드백 없이 기능이 비활성화됨.

**적용된 수정 (`js/core/utils.js`):**
```javascript
// 모듈 검증 API 추가
Utils.validateRequiredModules(modules, options)
// - modules: ['CrewData', 'BalanceData', ...]
// - options: { silent, showToast }
// - returns: { valid: boolean, missing: string[] }

Utils.waitForModules(modules, timeout)
// - 비동기 모듈 로드 대기 (Promise)

Utils.getCoreDataModules()
// - ['CrewData', 'EquipmentData', 'TraitData', 'EnemyData', 'FacilityData', 'BalanceData']

Utils.getCoreSystemModules()
// - ['GameState', 'Utils', 'SeedUtils']
```

**사용 예시:**
```javascript
// 페이지 초기화 시
const { valid, missing } = Utils.validateRequiredModules(
    ['CrewData', 'BalanceData'],
    { showToast: true }
);
if (!valid) {
    console.error('Cannot initialize: missing', missing);
    return;
}
```

### GameState 관련 권장사항

#### L-007: 멀티탭 충돌 방지 ✅ RESOLVED
**우선순위:** Low → **해결됨**
**해결일:** 2026-02-03

**설명:**
여러 브라우저 탭에서 게임 실행 시 localStorage GameState 충돌 가능.

**적용된 수정 (`js/core/game-state.js`):**
```javascript
// 멀티탭 감지 시스템 추가
GameState.initMultiTabDetection()  // init()에서 자동 호출
GameState.registerTab()             // 현재 탭 등록
GameState.unregisterTab()           // 탭 해제 (beforeunload)
GameState.handleStorageChange()     // storage 이벤트 핸들러
GameState.handleTabConflict()       // 충돌 시 처리
GameState.isCurrentlyActiveTab()    // 현재 탭이 활성 탭인지 확인
GameState.emitEvent()               // 커스텀 이벤트 발생
```

**동작:**
1. 각 탭에 고유 ID 부여
2. `storage` 이벤트로 다른 탭의 변경 감지
3. 충돌 시 Toast로 사용자에게 알림
4. 자동으로 최신 상태 동기화
5. `gamestate:stateChanged` 커스텀 이벤트 발생

**사용 예시:**
```javascript
// 다른 탭에서 상태 변경 시 UI 업데이트
window.addEventListener('gamestate:stateChanged', (e) => {
    if (e.detail.source === 'otherTab') {
        refreshUI();
    }
});
```
